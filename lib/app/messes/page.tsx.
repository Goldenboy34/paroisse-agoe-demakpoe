"use client"
import { useState } from 'react'
import { supabase } from '../../lib/supabase'

export default function DemandeMesse() {
  const [envoi, setEnvoi] = useState(false)

  async function envoyerMesse(e) {
    e.preventDefault()
    const form = e.target
    const { error } = await supabase.from('demandes_messes').insert([{
      nom_beneficiaire: form.nom.value,
      type_intention: form.intention.value,
      type_priere: form.type.value,
      date_debut: form.date.value,
      montant_offrande: form.montant.value,
      transaction_id: form.tid.value,
      telephone_expediteur: form.tel.value
    }])

    if (error) alert("Erreur : " + error.message)
    else setEnvoi(true)
  }

  if (envoi) return <div className="p-10 text-center font-bold text-green-600">Demande envoyée avec succès à la Paroisse !</div>

  return (
    <div className="max-w-md mx-auto m-10 p-6 bg-white shadow-2xl rounded-xl border-t-4 border-[#23318E]">
      <h1 className="text-xl font-bold text-[#23318E] mb-4 text-center">Demander une Messe</h1>
      <form onSubmit={envoyerMesse} className="space-y-4">
        <input name="nom" placeholder="Nom pour la messe" className="w-full p-2 border rounded" required />
        <select name="type" className="w-full p-2 border rounded">
          <option value="unique">Messe Unique</option>
          <option value="triduum">Triduum (3 jours)</option>
          <option value="neuvaine">Neuvaine (9 jours)</option>
        </select>
        <select name="intention" className="w-full p-2 border rounded">
          <option>Action de Grâce</option>
          <option>Repos de l'âme</option>
          <option>Santé / Guérison</option>
        </select>
        <input type="date" name="date" className="w-full p-2 border rounded" required />
        <div className="bg-gray-100 p-3 rounded text-sm">
          <p className="font-bold text-red-600">Paiement : Transfert au XX XX XX XX</p>
          <input name="montant" placeholder="Montant (FCFA)" type="number" className="w-full mt-2 p-2 border" required />
          <input name="tid" placeholder="ID Transaction / Référence" className="w-full mt-2 p-2 border" required />
          <input name="tel" placeholder="Votre numéro de téléphone" className="w-full mt-2 p-2 border" required />
        </div>
        <button className="w-full bg-[#23318E] text-white p-3 rounded-lg font-bold">ENVOYER LA DEMANDE</button>
      </form>
    </div>
  )
}
